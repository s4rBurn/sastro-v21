---
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths({ }) {
  const allPosts = Astro.fetchContent('../posts/*.md');
  const sortedPosts = allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
  const allTags = new Set();
  sortedPosts.map(post => {
      post.tags && post.tags.map(tag => allTags.add(tag))
  })
  
  return Array.from(allTags).map((tag) => {
    const filteredPosts = sortedPosts.filter((post) => post.tags.includes(tag))
    return {
      params: { tag },
      props: {
        pages: filteredPosts
      }
    };
  });
}

const { pages } = Astro.props;
const { tag } = Astro.request.params;

let title = tag; 
---
<BaseLayout title={title}>
    <main>
        <p style="font-size: 1.5em">Posts tagged with <em><span style="font-weight: bold; color:#3d5262;">{title}</span></em></p>
        {pages.map(post => <p><a href={post.url}>{post.title}</a></p>)}
    </main>
</BaseLayout>